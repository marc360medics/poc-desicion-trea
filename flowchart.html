<!DOCTYPE html>
<html lang="en">
  <body>
    <script src="https://unpkg.com/gojs@2.3.1/release/go.js"></script>
    <p>
      This is a minimalist HTML and JavaScript skeleton of the GoJS Sample
      <a href="https://gojs.net/latest/samples/flowchart.html">flowchart.html</a
      >. It was automatically generated from a button on the sample page, and
      does not contain the full HTML. It is intended as a starting point to
      adapt for your own usage. For many samples, you may need to inspect the
      <a
        href="https://github.com/NorthwoodsSoftware/GoJS/blob/master/samples/flowchart.html"
        >full source on Github</a
      >
      and copy other files or scripts.
    </p>
    <div id="allSampleContent" class="p-4 w-full">
      <script id="code">
        function init() {
          if (window.goSamples) goSamples() // init for these samples -- you don't need to call this

          // Since 2.2 you can also author concise templates with method chaining instead of GraphObject.make
          // For details, see https://gojs.net/latest/intro/buildingObjects.html
          const $ = go.GraphObject.make // for conciseness in defining templates

          myDiagram = $(
            go.Diagram,
            'myDiagramDiv', // must name or refer to the DIV HTML element
            {
              LinkDrawn: showLinkLabel, // this DiagramEvent listener is defined below
              LinkRelinked: showLinkLabel,
              'undoManager.isEnabled': true, // enable undo & redo
            }
          )

          // when the document is modified, add a "*" to the title and enable the "Save" button
          myDiagram.addDiagramListener('Modified', (e) => {
            var button = document.getElementById('SaveButton')
            if (button) button.disabled = !myDiagram.isModified
            var idx = document.title.indexOf('*')
            if (myDiagram.isModified) {
              if (idx < 0) document.title += '*'
            } else {
              if (idx >= 0) document.title = document.title.slice(0, idx)
            }
          })

          // helper definitions for node templates

          function nodeStyle() {
            return [
              // The Node.location comes from the "loc" property of the node data,
              // converted by the Point.parse static method.
              // If the Node.location is changed, it updates the "loc" property of the node data,
              // converting back using the Point.stringify static method.
              new go.Binding('location', 'loc', go.Point.parse).makeTwoWay(
                go.Point.stringify
              ),
              {
                // the Node.location is at the center of each node
                locationSpot: go.Spot.Center,
              },
            ]
          }

          // Define a function for creating a "port" that is normally transparent.
          // The "name" is used as the GraphObject.portId,
          // the "align" is used to determine where to position the port relative to the body of the node,
          // the "spot" is used to control how links connect with the port and whether the port
          // stretches along the side of the node,
          // and the boolean "output" and "input" arguments control whether the user can draw links from or to the port.
          function makePort(name, align, spot, output, input) {
            var horizontal =
              align.equals(go.Spot.Top) || align.equals(go.Spot.Bottom)
            // the port is basically just a transparent rectangle that stretches along the side of the node,
            // and becomes colored when the mouse passes over it
            return $(go.Shape, {
              fill: 'transparent', // changed to a color in the mouseEnter event handler
              strokeWidth: 0, // no stroke
              width: horizontal ? NaN : 8, // if not stretching horizontally, just 8 wide
              height: !horizontal ? NaN : 8, // if not stretching vertically, just 8 tall
              alignment: align, // align the port on the main Shape
              stretch: horizontal
                ? go.GraphObject.Horizontal
                : go.GraphObject.Vertical,
              portId: name, // declare this object to be a "port"
              fromSpot: spot, // declare where links may connect at this port
              fromLinkable: output, // declare whether the user may draw links from here
              toSpot: spot, // declare where links may connect at this port
              toLinkable: input, // declare whether the user may draw links to here
              cursor: 'pointer', // show a different cursor to indicate potential link point
              mouseEnter: (e, port) => {
                // the PORT argument will be this Shape
                if (!e.diagram.isReadOnly) port.fill = 'rgba(255,0,255,0.5)'
              },
              mouseLeave: (e, port) => (port.fill = 'transparent'),
            })
          }

          function textStyle() {
            return {
              font: 'bold 11pt Lato, Helvetica, Arial, sans-serif',
              stroke: '#F8F8F8',
            }
          }

          // define the Node templates for regular nodes

          myDiagram.nodeTemplateMap.add(
            '', // the default category
            $(
              go.Node,
              'Table',
              nodeStyle(),
              // the main object is a Panel that surrounds a TextBlock with a rectangular Shape
              $(
                go.Panel,
                'Auto',
                $(
                  go.Shape,
                  'Rectangle',
                  { fill: '#282c34', stroke: '#00A9C9', strokeWidth: 3.5 },
                  new go.Binding('figure', 'figure')
                ),
                $(
                  go.TextBlock,
                  textStyle(),
                  {
                    margin: 8,
                    maxSize: new go.Size(160, NaN),
                    wrap: go.TextBlock.WrapFit,
                    editable: true,
                  },
                  new go.Binding('text').makeTwoWay()
                )
              ),
              // four named ports, one on each side:
              makePort('T', go.Spot.Top, go.Spot.TopSide, false, true),
              makePort('L', go.Spot.Left, go.Spot.LeftSide, true, true),
              makePort('R', go.Spot.Right, go.Spot.RightSide, true, true),
              makePort('B', go.Spot.Bottom, go.Spot.BottomSide, true, false)
            )
          )

          myDiagram.nodeTemplateMap.add(
            'Conditional',
            $(
              go.Node,
              'Table',
              nodeStyle(),
              // the main object is a Panel that surrounds a TextBlock with a rectangular Shape
              $(
                go.Panel,
                'Auto',
                $(
                  go.Shape,
                  'Diamond',
                  { fill: '#282c34', stroke: '#00A9C9', strokeWidth: 3.5 },
                  new go.Binding('figure', 'figure')
                ),
                $(
                  go.TextBlock,
                  textStyle(),
                  {
                    margin: 8,
                    maxSize: new go.Size(160, NaN),
                    wrap: go.TextBlock.WrapFit,
                    editable: true,
                  },
                  new go.Binding('text').makeTwoWay()
                )
              ),
              // four named ports, one on each side:
              makePort('T', go.Spot.Top, go.Spot.Top, false, true),
              makePort('L', go.Spot.Left, go.Spot.Left, true, true),
              makePort('R', go.Spot.Right, go.Spot.Right, true, true),
              makePort('B', go.Spot.Bottom, go.Spot.Bottom, true, false)
            )
          )

          myDiagram.nodeTemplateMap.add(
            'Start',
            $(
              go.Node,
              'Table',
              nodeStyle(),
              $(
                go.Panel,
                'Spot',
                $(go.Shape, 'Circle', {
                  desiredSize: new go.Size(70, 70),
                  fill: '#282c34',
                  stroke: '#09d3ac',
                  strokeWidth: 3.5,
                }),
                $(go.TextBlock, 'Start', textStyle(), new go.Binding('text'))
              ),
              // three named ports, one on each side except the top, all output only:
              makePort('L', go.Spot.Left, go.Spot.Left, true, false),
              makePort('R', go.Spot.Right, go.Spot.Right, true, false),
              makePort('B', go.Spot.Bottom, go.Spot.Bottom, true, false)
            )
          )

          myDiagram.nodeTemplateMap.add(
            'End',
            $(
              go.Node,
              'Table',
              nodeStyle(),
              $(
                go.Panel,
                'Spot',
                $(go.Shape, 'Circle', {
                  desiredSize: new go.Size(60, 60),
                  fill: '#282c34',
                  stroke: '#DC3C00',
                  strokeWidth: 3.5,
                }),
                $(go.TextBlock, 'End', textStyle(), new go.Binding('text'))
              ),
              // three named ports, one on each side except the bottom, all input only:
              makePort('T', go.Spot.Top, go.Spot.Top, false, true),
              makePort('L', go.Spot.Left, go.Spot.Left, false, true),
              makePort('R', go.Spot.Right, go.Spot.Right, false, true)
            )
          )

          // taken from https://unpkg.com/gojs@2.3.1/extensions/Figures.js:
          go.Shape.defineFigureGenerator('File', (shape, w, h) => {
            var geo = new go.Geometry()
            var fig = new go.PathFigure(0, 0, true) // starting point
            geo.add(fig)
            fig.add(new go.PathSegment(go.PathSegment.Line, 0.75 * w, 0))
            fig.add(new go.PathSegment(go.PathSegment.Line, w, 0.25 * h))
            fig.add(new go.PathSegment(go.PathSegment.Line, w, h))
            fig.add(new go.PathSegment(go.PathSegment.Line, 0, h).close())
            var fig2 = new go.PathFigure(0.75 * w, 0, false)
            geo.add(fig2)
            // The Fold
            fig2.add(
              new go.PathSegment(go.PathSegment.Line, 0.75 * w, 0.25 * h)
            )
            fig2.add(new go.PathSegment(go.PathSegment.Line, w, 0.25 * h))
            geo.spot1 = new go.Spot(0, 0.25)
            geo.spot2 = go.Spot.BottomRight
            return geo
          })

          myDiagram.nodeTemplateMap.add(
            'Comment',
            $(
              go.Node,
              'Auto',
              nodeStyle(),
              $(go.Shape, 'File', {
                fill: '#282c34',
                stroke: '#DEE0A3',
                strokeWidth: 3,
              }),
              $(
                go.TextBlock,
                textStyle(),
                {
                  margin: 8,
                  maxSize: new go.Size(200, NaN),
                  wrap: go.TextBlock.WrapFit,
                  textAlign: 'center',
                  editable: true,
                },
                new go.Binding('text').makeTwoWay()
              )
              // no ports, because no links are allowed to connect with a comment
            )
          )

          // replace the default Link template in the linkTemplateMap
          myDiagram.linkTemplate = $(
            go.Link, // the whole link panel
            {
              routing: go.Link.AvoidsNodes,
              curve: go.Link.JumpOver,
              corner: 5,
              toShortLength: 4,
              relinkableFrom: true,
              relinkableTo: true,
              reshapable: true,
              resegmentable: true,
              // mouse-overs subtly highlight links:
              mouseEnter: (e, link) =>
                (link.findObject('HIGHLIGHT').stroke = 'rgba(30,144,255,0.2)'),
              mouseLeave: (e, link) =>
                (link.findObject('HIGHLIGHT').stroke = 'transparent'),
              selectionAdorned: false,
            },
            new go.Binding('points').makeTwoWay(),
            $(
              go.Shape, // the highlight shape, normally transparent
              {
                isPanelMain: true,
                strokeWidth: 8,
                stroke: 'transparent',
                name: 'HIGHLIGHT',
              }
            ),
            $(
              go.Shape, // the link path shape
              { isPanelMain: true, stroke: 'gray', strokeWidth: 2 },
              new go.Binding('stroke', 'isSelected', (sel) =>
                sel ? 'dodgerblue' : 'gray'
              ).ofObject()
            ),
            $(
              go.Shape, // the arrowhead
              { toArrow: 'standard', strokeWidth: 0, fill: 'gray' }
            ),
            $(
              go.Panel,
              'Auto', // the link label, normally not visible
              {
                visible: false,
                name: 'LABEL',
                segmentIndex: 2,
                segmentFraction: 0.5,
              },
              new go.Binding('visible', 'visible').makeTwoWay(),
              $(
                go.Shape,
                'RoundedRectangle', // the label shape
                { fill: '#F8F8F8', strokeWidth: 0 }
              ),
              $(
                go.TextBlock,
                'Yes', // the label
                {
                  textAlign: 'center',
                  font: '10pt helvetica, arial, sans-serif',
                  stroke: '#333333',
                  editable: true,
                },
                new go.Binding('text').makeTwoWay()
              )
            )
          )

          // Make link labels visible if coming out of a "conditional" node.
          // This listener is called by the "LinkDrawn" and "LinkRelinked" DiagramEvents.
          function showLinkLabel(e) {
            console.log(e)
            var label = e.subject.findObject('LABEL')
            if (label !== null)
              label.visible = e.subject.fromNode.data.category === 'Conditional'
          }

          // temporary links used by LinkingTool and RelinkingTool are also orthogonal:
          myDiagram.toolManager.linkingTool.temporaryLink.routing =
            go.Link.Orthogonal
          myDiagram.toolManager.relinkingTool.temporaryLink.routing =
            go.Link.Orthogonal

          load() // load an initial diagram from some JSON text

          // initialize the Palette that is on the left side of the page
          myPalette = $(
            go.Palette,
            'myPaletteDiv', // must name or refer to the DIV HTML element
            {
              // Instead of the default animation, use a custom fade-down
              'animationManager.initialAnimationStyle':
                go.AnimationManager.None,
              InitialAnimationStarting: animateFadeDown, // Instead, animate with this function

              nodeTemplateMap: myDiagram.nodeTemplateMap, // share the templates used by myDiagram
              model: new go.GraphLinksModel([
                // specify the contents of the Palette
                { category: 'Start', text: 'Start' },
                { text: 'Step' },
                { category: 'Conditional', text: '???' },
                { category: 'End', text: 'End' },
                { category: 'Comment', text: 'Comment' },
              ]),
            }
          )

          // This is a re-implementation of the default animation, except it fades in from downwards, instead of upwards.
          function animateFadeDown(e) {
            var diagram = e.diagram
            var animation = new go.Animation()
            animation.isViewportUnconstrained = true // So Diagram positioning rules let the animation start off-screen
            animation.easing = go.Animation.EaseOutExpo
            animation.duration = 900
            // Fade "down", in other words, fade in from above
            animation.add(
              diagram,
              'position',
              diagram.position.copy().offset(0, 200),
              diagram.position
            )
            animation.add(diagram, 'opacity', 0, 1)
            animation.start()
          }
        } // end init

        // Show the diagram's model in JSON format that the user may edit
        function save() {
          document.getElementById(
            'mySavedModel'
          ).value = myDiagram.model.toJson()
          myDiagram.isModified = false
        }
        function load() {
          myDiagram.model = go.Model.fromJson(
            document.getElementById('mySavedModel').value
          )
        }

        // print the diagram by opening a new window holding SVG images of the diagram contents for each page
        function printDiagram() {
          var svgWindow = window.open()
          if (!svgWindow) return // failure to open a new Window
          var printSize = new go.Size(700, 960)
          var bnds = myDiagram.documentBounds
          var x = bnds.x
          var y = bnds.y
          while (y < bnds.bottom) {
            while (x < bnds.right) {
              var svg = myDiagram.makeSvg({
                scale: 1.0,
                position: new go.Point(x, y),
                size: printSize,
              })
              svgWindow.document.body.appendChild(svg)
              x += printSize.width
            }
            x = bnds.x
            y += printSize.height
          }
          setTimeout(() => svgWindow.print(), 1)
        }
        window.addEventListener('DOMContentLoaded', init)
      </script>

      <div id="sample">
        <div
          style="width: 100%; display: flex; justify-content: space-between;"
        >
          <div
            id="myPaletteDiv"
            style="
              width: 100px;
              margin-right: 2px;
              background-color: rgb(40, 44, 52);
              position: relative;
              -webkit-tap-highlight-color: rgba(255, 255, 255, 0);
              cursor: auto;
            "
          >
            <canvas
              tabindex="0"
              width="200"
              height="1500"
              style="
                position: absolute;
                top: 0px;
                left: 0px;
                z-index: 2;
                user-select: none;
                touch-action: none;
                width: 100px;
                height: 750px;
                cursor: auto;
              "
              >This text is displayed if your browser does not support the
              Canvas HTML element.</canvas
            >
            <div
              style="
                position: absolute;
                overflow: auto;
                width: 100px;
                height: 750px;
                z-index: 1;
              "
            >
              <div style="position: absolute; width: 1px; height: 1px;"></div>
            </div>
          </div>
          <div
            id="myDiagramDiv"
            style="
              flex-grow: 1;
              height: 750px;
              background-color: rgb(40, 44, 52);
              position: relative;
              -webkit-tap-highlight-color: rgba(255, 255, 255, 0);
              cursor: auto;
              font: bold 11pt Lato, Helvetica, Arial, sans-serif;
            "
          >
            <canvas
              tabindex="0"
              width="1668"
              height="1500"
              style="
                position: absolute;
                top: 0px;
                left: 0px;
                z-index: 2;
                user-select: none;
                touch-action: none;
                width: 834px;
                height: 750px;
                cursor: auto;
              "
              >This text is displayed if your browser does not support the
              Canvas HTML element.</canvas
            >
            <div
              style="
                position: absolute;
                overflow: auto;
                width: 834px;
                height: 750px;
                z-index: 1;
              "
            >
              <div
                style="position: absolute; width: 1px; height: 756.188px;"
              ></div>
            </div>
          </div>
        </div>
        <p>
          The FlowChart sample demonstrates several key features of GoJS, namely
          <a href="../intro/palette.html">Palette</a>s,
          <a href="../intro/links.html">Linkable nodes</a>, Drag/Drop behavior,
          <a href="../intro/textBlocks.html">Text Editing</a>, and the use of
          <a href="../intro/templateMaps.html">Node Template Maps</a> in
          Diagrams.
        </p>
        <p>
          Mouse-over a Node to view its ports. Drag from these ports to create
          new Links. Selecting Links allows you to re-shape and re-link them.
          Selecting a Node and then clicking its TextBlock will allow you to
          edit text (except on the Start and End Nodes).
        </p>
        <button id="SaveButton" onclick="save()">Save</button>
        <button onclick="load()">Load</button>
        Diagram Model saved in JSON format:
        <textarea id="mySavedModel" style="width: 100%; height: 300px;">
{ "class": "go.GraphLinksModel",
"linkFromPortIdProperty": "fromPort",
"linkToPortIdProperty": "toPort",
"nodeDataArray": [
{"category":"Comment", "loc":"360 -10", "text":"Kookie Brittle", "key":-13},
{"key":-1, "category":"Start", "loc":"175 0", "text":"Start"},
{"key":0, "loc":"-5 75", "text":"Preheat oven to 375 F"},
{"key":1, "loc":"175 100", "text":"In a bowl, blend: 1 cup margarine, 1.5 teaspoon vanilla, 1 teaspoon salt"},
{"key":2, "loc":"175 200", "text":"Gradually beat in 1 cup sugar and 2 cups sifted flour"},
{"key":3, "loc":"175 290", "text":"Mix in 6 oz (1 cup) Nestle's Semi-Sweet Chocolate Morsels"},
{"key":4, "loc":"175 380", "text":"Press evenly into ungreased 15x10x1 pan"},
{"key":5, "loc":"355 85", "text":"Finely chop 1/2 cup of your choice of nuts"},
{"key":6, "loc":"175 450", "text":"Sprinkle nuts on top"},
{"key":7, "loc":"175 515", "text":"Bake for 25 minutes and let cool"},
{"key":8, "loc":"175 585", "text":"Cut into rectangular grid"},
{"key":-2, "category":"End", "loc":"175 660", "text":"Enjoy!"}
],
"linkDataArray": [
{"from":1, "to":2, "fromPort":"B", "toPort":"T"},
{"from":2, "to":3, "fromPort":"B", "toPort":"T"},
{"from":3, "to":4, "fromPort":"B", "toPort":"T"},
{"from":4, "to":6, "fromPort":"B", "toPort":"T"},
{"from":6, "to":7, "fromPort":"B", "toPort":"T"},
{"from":7, "to":8, "fromPort":"B", "toPort":"T"},
{"from":8, "to":-2, "fromPort":"B", "toPort":"T"},
{"from":-1, "to":0, "fromPort":"B", "toPort":"T"},
{"from":-1, "to":1, "fromPort":"B", "toPort":"T"},
{"from":-1, "to":5, "fromPort":"B", "toPort":"T"},
{"from":5, "to":4, "fromPort":"B", "toPort":"T"},
{"from":0, "to":4, "fromPort":"B", "toPort":"T"}
]}
</textarea
        >
        <button onclick="printDiagram()">Print Diagram Using SVG</button>
        <p class="text-xs">
          GoJS version 2.3.1. Copyright 1998-2023 by Northwoods Software.
        </p>
      </div>
      <link
        href="https://fonts.googleapis.com/css?family=Lato:300,400,700&amp;swap"
        rel="stylesheet"
        type="text/css"
      />
      <p>
        <a
          href="https://github.com/NorthwoodsSoftware/GoJS/blob/master/samples/flowchart.html"
          target="_blank"
          >View this sample page's source on GitHub</a
        >
      </p>
      <pre class="language-js">
  <span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>goSamples<span class="token punctuation">)</span> <span class="token function">goSamples</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// init for these samples -- you don't need to call this</span>

    <span class="token comment">// Since 2.2 you can also author concise templates with method chaining instead of GraphObject.make</span>
    <span class="token comment">// For details, see https://gojs.net/latest/intro/buildingObjects.html</span>
    <span class="token keyword">const</span> $ <span class="token operator">=</span> go<span class="token punctuation">.</span>GraphObject<span class="token punctuation">.</span>make<span class="token punctuation">;</span>  <span class="token comment">// for conciseness in defining templates</span>

    myDiagram <span class="token operator">=</span>
      <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Diagram<span class="token punctuation">,</span> <span class="token string">"myDiagramDiv"</span><span class="token punctuation">,</span>  <span class="token comment">// must name or refer to the DIV HTML element</span>
        <span class="token punctuation">{</span>
          <span class="token string">"LinkDrawn"</span><span class="token operator">:</span> showLinkLabel<span class="token punctuation">,</span>  <span class="token comment">// this DiagramEvent listener is defined below</span>
          <span class="token string">"LinkRelinked"</span><span class="token operator">:</span> showLinkLabel<span class="token punctuation">,</span>
          <span class="token string">"undoManager.isEnabled"</span><span class="token operator">:</span> <span class="token boolean">true</span>  <span class="token comment">// enable undo &amp; redo</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// when the document is modified, add a "*" to the title and enable the "Save" button</span>
    myDiagram<span class="token punctuation">.</span><span class="token function">addDiagramListener</span><span class="token punctuation">(</span><span class="token string">"Modified"</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"SaveButton"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>button<span class="token punctuation">)</span> button<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token operator">!</span>myDiagram<span class="token punctuation">.</span>isModified<span class="token punctuation">;</span>
      <span class="token keyword">var</span> idx <span class="token operator">=</span> document<span class="token punctuation">.</span>title<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>myDiagram<span class="token punctuation">.</span>isModified<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>idx <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> document<span class="token punctuation">.</span>title <span class="token operator">+=</span> <span class="token string">"*"</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>idx <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> document<span class="token punctuation">.</span>title <span class="token operator">=</span> document<span class="token punctuation">.</span>title<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> idx<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// helper definitions for node templates</span>

    <span class="token keyword">function</span> <span class="token function">nodeStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token comment">// The Node.location comes from the "loc" property of the node data,</span>
        <span class="token comment">// converted by the Point.parse static method.</span>
        <span class="token comment">// If the Node.location is changed, it updates the "loc" property of the node data,</span>
        <span class="token comment">// converting back using the Point.stringify static method.</span>
        <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">"location"</span><span class="token punctuation">,</span> <span class="token string">"loc"</span><span class="token punctuation">,</span> go<span class="token punctuation">.</span>Point<span class="token punctuation">.</span>parse<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeTwoWay</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Point<span class="token punctuation">.</span>stringify<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token comment">// the Node.location is at the center of each node</span>
          locationSpot<span class="token operator">:</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Center
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Define a function for creating a "port" that is normally transparent.</span>
    <span class="token comment">// The "name" is used as the GraphObject.portId,</span>
    <span class="token comment">// the "align" is used to determine where to position the port relative to the body of the node,</span>
    <span class="token comment">// the "spot" is used to control how links connect with the port and whether the port</span>
    <span class="token comment">// stretches along the side of the node,</span>
    <span class="token comment">// and the boolean "output" and "input" arguments control whether the user can draw links from or to the port.</span>
    <span class="token keyword">function</span> <span class="token function">makePort</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> align<span class="token punctuation">,</span> spot<span class="token punctuation">,</span> output<span class="token punctuation">,</span> input</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> horizontal <span class="token operator">=</span> align<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Top<span class="token punctuation">)</span> <span class="token operator">||</span> align<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Bottom<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// the port is basically just a transparent rectangle that stretches along the side of the node,</span>
      <span class="token comment">// and becomes colored when the mouse passes over it</span>
      <span class="token keyword">return</span> <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Shape<span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          fill<span class="token operator">:</span> <span class="token string">"transparent"</span><span class="token punctuation">,</span>  <span class="token comment">// changed to a color in the mouseEnter event handler</span>
          strokeWidth<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token comment">// no stroke</span>
          width<span class="token operator">:</span> horizontal <span class="token operator">?</span> <span class="token number">NaN</span> <span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token comment">// if not stretching horizontally, just 8 wide</span>
          height<span class="token operator">:</span> <span class="token operator">!</span>horizontal <span class="token operator">?</span> <span class="token number">NaN</span> <span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token comment">// if not stretching vertically, just 8 tall</span>
          alignment<span class="token operator">:</span> align<span class="token punctuation">,</span>  <span class="token comment">// align the port on the main Shape</span>
          stretch<span class="token operator">:</span> <span class="token punctuation">(</span>horizontal <span class="token operator">?</span> go<span class="token punctuation">.</span>GraphObject<span class="token punctuation">.</span>Horizontal <span class="token operator">:</span> go<span class="token punctuation">.</span>GraphObject<span class="token punctuation">.</span>Vertical<span class="token punctuation">)</span><span class="token punctuation">,</span>
          portId<span class="token operator">:</span> name<span class="token punctuation">,</span>  <span class="token comment">// declare this object to be a "port"</span>
          fromSpot<span class="token operator">:</span> spot<span class="token punctuation">,</span>  <span class="token comment">// declare where links may connect at this port</span>
          fromLinkable<span class="token operator">:</span> output<span class="token punctuation">,</span>  <span class="token comment">// declare whether the user may draw links from here</span>
          toSpot<span class="token operator">:</span> spot<span class="token punctuation">,</span>  <span class="token comment">// declare where links may connect at this port</span>
          toLinkable<span class="token operator">:</span> input<span class="token punctuation">,</span>  <span class="token comment">// declare whether the user may draw links to here</span>
          cursor<span class="token operator">:</span> <span class="token string">"pointer"</span><span class="token punctuation">,</span>  <span class="token comment">// show a different cursor to indicate potential link point</span>
          <span class="token function-variable function">mouseEnter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> port</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// the PORT argument will be this Shape</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>e<span class="token punctuation">.</span>diagram<span class="token punctuation">.</span>isReadOnly<span class="token punctuation">)</span> port<span class="token punctuation">.</span>fill <span class="token operator">=</span> <span class="token string">"rgba(255,0,255,0.5)"</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token function-variable function">mouseLeave</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> port</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> port<span class="token punctuation">.</span>fill <span class="token operator">=</span> <span class="token string">"transparent"</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">textStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        font<span class="token operator">:</span> <span class="token string">"bold 11pt Lato, Helvetica, Arial, sans-serif"</span><span class="token punctuation">,</span>
        stroke<span class="token operator">:</span> <span class="token string">"#F8F8F8"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// define the Node templates for regular nodes</span>

    myDiagram<span class="token punctuation">.</span>nodeTemplateMap<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span>  <span class="token comment">// the default category</span>
      <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Node<span class="token punctuation">,</span> <span class="token string">"Table"</span><span class="token punctuation">,</span> <span class="token function">nodeStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// the main object is a Panel that surrounds a TextBlock with a rectangular Shape</span>
        <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Panel<span class="token punctuation">,</span> <span class="token string">"Auto"</span><span class="token punctuation">,</span>
          <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Shape<span class="token punctuation">,</span> <span class="token string">"Rectangle"</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> fill<span class="token operator">:</span> <span class="token string">"#282c34"</span><span class="token punctuation">,</span> stroke<span class="token operator">:</span> <span class="token string">"#00A9C9"</span><span class="token punctuation">,</span> strokeWidth<span class="token operator">:</span> <span class="token number">3.5</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">"figure"</span><span class="token punctuation">,</span> <span class="token string">"figure"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>TextBlock<span class="token punctuation">,</span> <span class="token function">textStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              margin<span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
              maxSize<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Size</span><span class="token punctuation">(</span><span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">NaN</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              wrap<span class="token operator">:</span> go<span class="token punctuation">.</span>TextBlock<span class="token punctuation">.</span>WrapFit<span class="token punctuation">,</span>
              editable<span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeTwoWay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// four named ports, one on each side:</span>
        <span class="token function">makePort</span><span class="token punctuation">(</span><span class="token string">"T"</span><span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Top<span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>TopSide<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">makePort</span><span class="token punctuation">(</span><span class="token string">"L"</span><span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Left<span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>LeftSide<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">makePort</span><span class="token punctuation">(</span><span class="token string">"R"</span><span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Right<span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>RightSide<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">makePort</span><span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Bottom<span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>BottomSide<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    myDiagram<span class="token punctuation">.</span>nodeTemplateMap<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"Conditional"</span><span class="token punctuation">,</span>
      <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Node<span class="token punctuation">,</span> <span class="token string">"Table"</span><span class="token punctuation">,</span> <span class="token function">nodeStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// the main object is a Panel that surrounds a TextBlock with a rectangular Shape</span>
        <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Panel<span class="token punctuation">,</span> <span class="token string">"Auto"</span><span class="token punctuation">,</span>
          <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Shape<span class="token punctuation">,</span> <span class="token string">"Diamond"</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> fill<span class="token operator">:</span> <span class="token string">"#282c34"</span><span class="token punctuation">,</span> stroke<span class="token operator">:</span> <span class="token string">"#00A9C9"</span><span class="token punctuation">,</span> strokeWidth<span class="token operator">:</span> <span class="token number">3.5</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">"figure"</span><span class="token punctuation">,</span> <span class="token string">"figure"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>TextBlock<span class="token punctuation">,</span> <span class="token function">textStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              margin<span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
              maxSize<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Size</span><span class="token punctuation">(</span><span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">NaN</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              wrap<span class="token operator">:</span> go<span class="token punctuation">.</span>TextBlock<span class="token punctuation">.</span>WrapFit<span class="token punctuation">,</span>
              editable<span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeTwoWay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// four named ports, one on each side:</span>
        <span class="token function">makePort</span><span class="token punctuation">(</span><span class="token string">"T"</span><span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Top<span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Top<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">makePort</span><span class="token punctuation">(</span><span class="token string">"L"</span><span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Left<span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Left<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">makePort</span><span class="token punctuation">(</span><span class="token string">"R"</span><span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Right<span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Right<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">makePort</span><span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Bottom<span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Bottom<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    myDiagram<span class="token punctuation">.</span>nodeTemplateMap<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"Start"</span><span class="token punctuation">,</span>
      <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Node<span class="token punctuation">,</span> <span class="token string">"Table"</span><span class="token punctuation">,</span> <span class="token function">nodeStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Panel<span class="token punctuation">,</span> <span class="token string">"Spot"</span><span class="token punctuation">,</span>
          <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Shape<span class="token punctuation">,</span> <span class="token string">"Circle"</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> desiredSize<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Size</span><span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fill<span class="token operator">:</span> <span class="token string">"#282c34"</span><span class="token punctuation">,</span> stroke<span class="token operator">:</span> <span class="token string">"#09d3ac"</span><span class="token punctuation">,</span> strokeWidth<span class="token operator">:</span> <span class="token number">3.5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>TextBlock<span class="token punctuation">,</span> <span class="token string">"Start"</span><span class="token punctuation">,</span> <span class="token function">textStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// three named ports, one on each side except the top, all output only:</span>
        <span class="token function">makePort</span><span class="token punctuation">(</span><span class="token string">"L"</span><span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Left<span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Left<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">makePort</span><span class="token punctuation">(</span><span class="token string">"R"</span><span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Right<span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Right<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">makePort</span><span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Bottom<span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Bottom<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    myDiagram<span class="token punctuation">.</span>nodeTemplateMap<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"End"</span><span class="token punctuation">,</span>
      <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Node<span class="token punctuation">,</span> <span class="token string">"Table"</span><span class="token punctuation">,</span> <span class="token function">nodeStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Panel<span class="token punctuation">,</span> <span class="token string">"Spot"</span><span class="token punctuation">,</span>
          <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Shape<span class="token punctuation">,</span> <span class="token string">"Circle"</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> desiredSize<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Size</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fill<span class="token operator">:</span> <span class="token string">"#282c34"</span><span class="token punctuation">,</span> stroke<span class="token operator">:</span> <span class="token string">"#DC3C00"</span><span class="token punctuation">,</span> strokeWidth<span class="token operator">:</span> <span class="token number">3.5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>TextBlock<span class="token punctuation">,</span> <span class="token string">"End"</span><span class="token punctuation">,</span> <span class="token function">textStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// three named ports, one on each side except the bottom, all input only:</span>
        <span class="token function">makePort</span><span class="token punctuation">(</span><span class="token string">"T"</span><span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Top<span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Top<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">makePort</span><span class="token punctuation">(</span><span class="token string">"L"</span><span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Left<span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Left<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">makePort</span><span class="token punctuation">(</span><span class="token string">"R"</span><span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Right<span class="token punctuation">,</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Right<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// taken from https://unpkg.com/gojs@2.3.1/extensions/Figures.js:</span>
    go<span class="token punctuation">.</span>Shape<span class="token punctuation">.</span><span class="token function">defineFigureGenerator</span><span class="token punctuation">(</span><span class="token string">"File"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">shape<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> geo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Geometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> fig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>PathFigure</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// starting point</span>
      geo<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fig<span class="token punctuation">)</span><span class="token punctuation">;</span>
      fig<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>PathSegment</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>PathSegment<span class="token punctuation">.</span>Line<span class="token punctuation">,</span> <span class="token number">.75</span> <span class="token operator">*</span> w<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      fig<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>PathSegment</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>PathSegment<span class="token punctuation">.</span>Line<span class="token punctuation">,</span> w<span class="token punctuation">,</span> <span class="token number">.25</span> <span class="token operator">*</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      fig<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>PathSegment</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>PathSegment<span class="token punctuation">.</span>Line<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      fig<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>PathSegment</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>PathSegment<span class="token punctuation">.</span>Line<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> fig2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>PathFigure</span><span class="token punctuation">(</span><span class="token number">.75</span> <span class="token operator">*</span> w<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      geo<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fig2<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// The Fold</span>
      fig2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>PathSegment</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>PathSegment<span class="token punctuation">.</span>Line<span class="token punctuation">,</span> <span class="token number">.75</span> <span class="token operator">*</span> w<span class="token punctuation">,</span> <span class="token number">.25</span> <span class="token operator">*</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      fig2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>PathSegment</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>PathSegment<span class="token punctuation">.</span>Line<span class="token punctuation">,</span> w<span class="token punctuation">,</span> <span class="token number">.25</span> <span class="token operator">*</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      geo<span class="token punctuation">.</span>spot1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Spot</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">.25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      geo<span class="token punctuation">.</span>spot2 <span class="token operator">=</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>BottomRight<span class="token punctuation">;</span>
      <span class="token keyword">return</span> geo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    myDiagram<span class="token punctuation">.</span>nodeTemplateMap<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"Comment"</span><span class="token punctuation">,</span>
      <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Node<span class="token punctuation">,</span> <span class="token string">"Auto"</span><span class="token punctuation">,</span> <span class="token function">nodeStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Shape<span class="token punctuation">,</span> <span class="token string">"File"</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> fill<span class="token operator">:</span> <span class="token string">"#282c34"</span><span class="token punctuation">,</span> stroke<span class="token operator">:</span> <span class="token string">"#DEE0A3"</span><span class="token punctuation">,</span> strokeWidth<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>TextBlock<span class="token punctuation">,</span> <span class="token function">textStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            margin<span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
            maxSize<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Size</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">NaN</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            wrap<span class="token operator">:</span> go<span class="token punctuation">.</span>TextBlock<span class="token punctuation">.</span>WrapFit<span class="token punctuation">,</span>
            textAlign<span class="token operator">:</span> <span class="token string">"center"</span><span class="token punctuation">,</span>
            editable<span class="token operator">:</span> <span class="token boolean">true</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeTwoWay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">// no ports, because no links are allowed to connect with a comment</span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">// replace the default Link template in the linkTemplateMap</span>
    myDiagram<span class="token punctuation">.</span>linkTemplate <span class="token operator">=</span>
      <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Link<span class="token punctuation">,</span>  <span class="token comment">// the whole link panel</span>
        <span class="token punctuation">{</span>
          routing<span class="token operator">:</span> go<span class="token punctuation">.</span>Link<span class="token punctuation">.</span>AvoidsNodes<span class="token punctuation">,</span>
          curve<span class="token operator">:</span> go<span class="token punctuation">.</span>Link<span class="token punctuation">.</span>JumpOver<span class="token punctuation">,</span>
          corner<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> toShortLength<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
          relinkableFrom<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          relinkableTo<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          reshapable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          resegmentable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token comment">// mouse-overs subtly highlight links:</span>
          <span class="token function-variable function">mouseEnter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> link</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> link<span class="token punctuation">.</span><span class="token function">findObject</span><span class="token punctuation">(</span><span class="token string">"HIGHLIGHT"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stroke <span class="token operator">=</span> <span class="token string">"rgba(30,144,255,0.2)"</span><span class="token punctuation">,</span>
          <span class="token function-variable function">mouseLeave</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> link</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> link<span class="token punctuation">.</span><span class="token function">findObject</span><span class="token punctuation">(</span><span class="token string">"HIGHLIGHT"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stroke <span class="token operator">=</span> <span class="token string">"transparent"</span><span class="token punctuation">,</span>
          selectionAdorned<span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">"points"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeTwoWay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Shape<span class="token punctuation">,</span>  <span class="token comment">// the highlight shape, normally transparent</span>
          <span class="token punctuation">{</span> isPanelMain<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> strokeWidth<span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span> stroke<span class="token operator">:</span> <span class="token string">"transparent"</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">"HIGHLIGHT"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Shape<span class="token punctuation">,</span>  <span class="token comment">// the link path shape</span>
          <span class="token punctuation">{</span> isPanelMain<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> stroke<span class="token operator">:</span> <span class="token string">"gray"</span><span class="token punctuation">,</span> strokeWidth<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">"stroke"</span><span class="token punctuation">,</span> <span class="token string">"isSelected"</span><span class="token punctuation">,</span> <span class="token parameter">sel</span> <span class="token operator">=&gt;</span> sel <span class="token operator">?</span> <span class="token string">"dodgerblue"</span> <span class="token operator">:</span> <span class="token string">"gray"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ofObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Shape<span class="token punctuation">,</span>  <span class="token comment">// the arrowhead</span>
          <span class="token punctuation">{</span> toArrow<span class="token operator">:</span> <span class="token string">"standard"</span><span class="token punctuation">,</span> strokeWidth<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> fill<span class="token operator">:</span> <span class="token string">"gray"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Panel<span class="token punctuation">,</span> <span class="token string">"Auto"</span><span class="token punctuation">,</span>  <span class="token comment">// the link label, normally not visible</span>
          <span class="token punctuation">{</span> visible<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">"LABEL"</span><span class="token punctuation">,</span> segmentIndex<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> segmentFraction<span class="token operator">:</span> <span class="token number">0.5</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">"visible"</span><span class="token punctuation">,</span> <span class="token string">"visible"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeTwoWay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Shape<span class="token punctuation">,</span> <span class="token string">"RoundedRectangle"</span><span class="token punctuation">,</span>  <span class="token comment">// the label shape</span>
            <span class="token punctuation">{</span> fill<span class="token operator">:</span> <span class="token string">"#F8F8F8"</span><span class="token punctuation">,</span> strokeWidth<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>TextBlock<span class="token punctuation">,</span> <span class="token string">"Yes"</span><span class="token punctuation">,</span>  <span class="token comment">// the label</span>
            <span class="token punctuation">{</span>
              textAlign<span class="token operator">:</span> <span class="token string">"center"</span><span class="token punctuation">,</span>
              font<span class="token operator">:</span> <span class="token string">"10pt helvetica, arial, sans-serif"</span><span class="token punctuation">,</span>
              stroke<span class="token operator">:</span> <span class="token string">"#333333"</span><span class="token punctuation">,</span>
              editable<span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeTwoWay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Make link labels visible if coming out of a "conditional" node.</span>
    <span class="token comment">// This listener is called by the "LinkDrawn" and "LinkRelinked" DiagramEvents.</span>
    <span class="token keyword">function</span> <span class="token function">showLinkLabel</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> label <span class="token operator">=</span> e<span class="token punctuation">.</span>subject<span class="token punctuation">.</span><span class="token function">findObject</span><span class="token punctuation">(</span><span class="token string">"LABEL"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>label <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> label<span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>subject<span class="token punctuation">.</span>fromNode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>category <span class="token operator">===</span> <span class="token string">"Conditional"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// temporary links used by LinkingTool and RelinkingTool are also orthogonal:</span>
    myDiagram<span class="token punctuation">.</span>toolManager<span class="token punctuation">.</span>linkingTool<span class="token punctuation">.</span>temporaryLink<span class="token punctuation">.</span>routing <span class="token operator">=</span> go<span class="token punctuation">.</span>Link<span class="token punctuation">.</span>Orthogonal<span class="token punctuation">;</span>
    myDiagram<span class="token punctuation">.</span>toolManager<span class="token punctuation">.</span>relinkingTool<span class="token punctuation">.</span>temporaryLink<span class="token punctuation">.</span>routing <span class="token operator">=</span> go<span class="token punctuation">.</span>Link<span class="token punctuation">.</span>Orthogonal<span class="token punctuation">;</span>

    <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// load an initial diagram from some JSON text</span>

    <span class="token comment">// initialize the Palette that is on the left side of the page</span>
    myPalette <span class="token operator">=</span>
      <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Palette<span class="token punctuation">,</span> <span class="token string">"myPaletteDiv"</span><span class="token punctuation">,</span>  <span class="token comment">// must name or refer to the DIV HTML element</span>
        <span class="token punctuation">{</span>
          <span class="token comment">// Instead of the default animation, use a custom fade-down</span>
          <span class="token string">"animationManager.initialAnimationStyle"</span><span class="token operator">:</span> go<span class="token punctuation">.</span>AnimationManager<span class="token punctuation">.</span>None<span class="token punctuation">,</span>
          <span class="token string">"InitialAnimationStarting"</span><span class="token operator">:</span> animateFadeDown<span class="token punctuation">,</span> <span class="token comment">// Instead, animate with this function</span>

          nodeTemplateMap<span class="token operator">:</span> myDiagram<span class="token punctuation">.</span>nodeTemplateMap<span class="token punctuation">,</span>  <span class="token comment">// share the templates used by myDiagram</span>
          model<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>GraphLinksModel</span><span class="token punctuation">(</span><span class="token punctuation">[</span>  <span class="token comment">// specify the contents of the Palette</span>
            <span class="token punctuation">{</span> category<span class="token operator">:</span> <span class="token string">"Start"</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">"Start"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">"Step"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> category<span class="token operator">:</span> <span class="token string">"Conditional"</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">"???"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> category<span class="token operator">:</span> <span class="token string">"End"</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">"End"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> category<span class="token operator">:</span> <span class="token string">"Comment"</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">"Comment"</span> <span class="token punctuation">}</span>
          <span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// This is a re-implementation of the default animation, except it fades in from downwards, instead of upwards.</span>
    <span class="token keyword">function</span> <span class="token function">animateFadeDown</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> diagram <span class="token operator">=</span> e<span class="token punctuation">.</span>diagram<span class="token punctuation">;</span>
      <span class="token keyword">var</span> animation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Animation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      animation<span class="token punctuation">.</span>isViewportUnconstrained <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// So Diagram positioning rules let the animation start off-screen</span>
      animation<span class="token punctuation">.</span>easing <span class="token operator">=</span> go<span class="token punctuation">.</span>Animation<span class="token punctuation">.</span>EaseOutExpo<span class="token punctuation">;</span>
      animation<span class="token punctuation">.</span>duration <span class="token operator">=</span> <span class="token number">900</span><span class="token punctuation">;</span>
      <span class="token comment">// Fade "down", in other words, fade in from above</span>
      animation<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>diagram<span class="token punctuation">,</span> <span class="token string">'position'</span><span class="token punctuation">,</span> diagram<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> diagram<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
      animation<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>diagram<span class="token punctuation">,</span> <span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      animation<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span> <span class="token comment">// end init</span>


  <span class="token comment">// Show the diagram's model in JSON format that the user may edit</span>
  <span class="token keyword">function</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"mySavedModel"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span> myDiagram<span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    myDiagram<span class="token punctuation">.</span>isModified <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    myDiagram<span class="token punctuation">.</span>model <span class="token operator">=</span> go<span class="token punctuation">.</span>Model<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"mySavedModel"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// print the diagram by opening a new window holding SVG images of the diagram contents for each page</span>
  <span class="token keyword">function</span> <span class="token function">printDiagram</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> svgWindow <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>svgWindow<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>  <span class="token comment">// failure to open a new Window</span>
    <span class="token keyword">var</span> printSize <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Size</span><span class="token punctuation">(</span><span class="token number">700</span><span class="token punctuation">,</span> <span class="token number">960</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> bnds <span class="token operator">=</span> myDiagram<span class="token punctuation">.</span>documentBounds<span class="token punctuation">;</span>
    <span class="token keyword">var</span> x <span class="token operator">=</span> bnds<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
    <span class="token keyword">var</span> y <span class="token operator">=</span> bnds<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>y <span class="token operator">&lt;</span> bnds<span class="token punctuation">.</span>bottom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> bnds<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> svg <span class="token operator">=</span> myDiagram<span class="token punctuation">.</span><span class="token function">makeSvg</span><span class="token punctuation">(</span><span class="token punctuation">{</span> scale<span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> position<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token operator">:</span> printSize <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        svgWindow<span class="token punctuation">.</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>svg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        x <span class="token operator">+=</span> printSize<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      x <span class="token operator">=</span> bnds<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
      y <span class="token operator">+=</span> printSize<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> svgWindow<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> init<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
    </div>
  </body>
</html>
